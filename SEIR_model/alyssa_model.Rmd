---
title: "SEIR Model with Vaccination"
author: "Alyssa Anastasi"
date: "`r format(Sys.time(), '%B %Y')`"
  output:
  pdf_document: default
  html_document: default
---

## Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(deSolve)
library(tidyverse)
library(MetBrewer)
library(directlabels)
library(cowplot)
library(viridis)
library(RColorBrewer)
library(MetBrewer)
library(ggrepel)
library(spatstat.utils)
source("alyssa_seir.R")
source("alyssa_SEIR_params.R")
```

## No vaccination

### Time & Vacc Parms
```{r}
times <- 1:420
vaccC <- function(t){0}
vaccCA <- function(t){0}
vaccP <- function(t){0}
vaccS <- function(t){0}
```

### COVID 
```{r}
COVIDoutNoVac <- ode(y=init, func = seir, times=times, parms = covid_parms) %>% 
  as.data.frame() %>% as_tibble() %>% pivot_longer(-time) %>%
  mutate(name = fct_relevel(name, names(init)),
         type = "No vaccination") %>%
  mutate(group = case_when(
      grepl("^S_C1|^S_C2|^E_C1|^E_C2|^I_C1|^I_C2|^E_C2|^R_C1|^R_C2|^D_C1|^D_C2", name) ~ "Children",
      grepl("^S_CA|^E_CA|^I_CA|^R_CA|^D_CA", name) ~ "Childless Adults",
      grepl("^S_P|^E_P|^I_P|^R_P|^D_P", name) ~ "Adults with Children (Parents)",
      grepl("^S_S|^E_S|^I_S|^R_S|^D_S", name) ~ "Adults (50+)",
  )) %>%
    mutate(label = case_when(
      grepl("^S_.*1$", name) ~ "Susceptible (First)",
      grepl("^S_.*2$", name) ~ "Susceptible (Second)",
      grepl("^E_.*1$", name) ~ "Exposed (First)",
      grepl("^E_.*2$", name) ~ "Exposed (Second)",
      grepl("^I_.*1$", name) ~ "Infected (First)",
      grepl("^I_.*2$", name) ~ "Infected (Second)",
      grepl("^R_.*1$", name) ~ "Recovered (First)",
      grepl("^R_.*2$", name) ~ "Recovered (Second)",
      grepl("^D_.*1$", name) ~ "Dead (First)",
      grepl("^D_.*2$", name) ~ "Dead (Second)"
  ))


COVIDplotNoVac <- COVIDoutNoVac %>% drop_na(label) %>% ggplot(aes(x=time,y=value, color=label)) + 
  geom_line() + # geom_text(data=subset(outNoVac, time == max(time)-100), aes(label=label), hjust=-0.1, vjust=-0.5, size=3) + 
  facet_wrap(~group, scales = "free", ncol = 1)

```

```{R}
COVIDplotNoVac
```

### Flu
```{R}
FLUoutNoVac <- ode(y=init, func = seir, times=times, parms = flu_parms) %>% 
  as.data.frame() %>% as_tibble() %>% pivot_longer(-time) %>%
  mutate(name = fct_relevel(name, names(init)),
         type = "No vaccination") %>%
  mutate(group = case_when(
      grepl("^S_C1|^S_C2|^E_C1|^E_C2|^I_C1|^I_C2|^E_C2|^R_C1|^R_C2|^D_C1|^D_C2", name) ~ "Children",
      grepl("^S_CA|^E_CA|^I_CA|^R_CA|^D_CA", name) ~ "Childless Adults",
      grepl("^S_P|^E_P|^I_P|^R_P|^D_P", name) ~ "Adults with Children (Parents)",
      grepl("^S_S|^E_S|^I_S|^R_S|^D_S", name) ~ "Adults (50+)",
  )) %>%
    mutate(label = case_when(
      grepl("^S_.*1$", name) ~ "Susceptible (First)",
      grepl("^S_.*2$", name) ~ "Susceptible (Second)",
      grepl("^E_.*1$", name) ~ "Exposed (First)",
      grepl("^E_.*2$", name) ~ "Exposed (Second)",
      grepl("^I_.*1$", name) ~ "Infected (First)",
      grepl("^I_.*2$", name) ~ "Infected (Second)",
      grepl("^R_.*1$", name) ~ "Recovered (First)",
      grepl("^R_.*2$", name) ~ "Recovered (Second)",
      grepl("^D_.*1$", name) ~ "Dead (First)",
      grepl("^D_.*2$", name) ~ "Dead (Second)"
  ))


FLUplotNoVac <- FLUoutNoVac %>% drop_na(label) %>% ggplot(aes(x=time,y=value, color=label)) + 
  geom_line() + # geom_text(data=subset(outNoVac, time == max(time)-100), aes(label=label), hjust=-0.1, vjust=-0.5, size=3) + 
  facet_wrap(~group, scales = "free", ncol = 1)

```

```{R}
FLUplotNoVac
```